name: Scorecard JSON Generator

on:
  schedule:
    - cron: '0 2 * * 1'  # Every Monday at 2 AM UTC
  push:
    branches: [ "main" ]
  workflow_dispatch:

permissions:
  contents: write  # Required to commit back changes

jobs:
  scorecard-json:
    name: Generate JSON Scorecard
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Create .backstage directory
        run: mkdir -p .backstage

      - name: Run Scorecard in JSON format
        uses: ossf/scorecard-action@v2.4.1
        with:
          results_file: .backstage/scorecard.json
          results_format: json
          publish_results: false  # Donâ€™t publish to public API

      - name: Commit scorecard.json to repo
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add .backstage/scorecard.json
          git commit -m "Update OpenSSF scorecard.json [ci skip]" || echo "No changes"
          git push
